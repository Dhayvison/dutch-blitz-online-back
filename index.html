<!doctype html>
<html lang="en">

<head>
  <title>Dutch Blitz Chat</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body>

  <button type="button"
    class="btn btn-primary position-absolute bottom-0 end-0 m-3 p-3 rounded-circle shadow d-flex justify-content-center align-items-center"
    data-bs-toggle="modal" data-bs-target="#chat-modal">
    <span class="material-icons">
      forum
    </span>
  </button>

  <div class="modal fade" id="chat-modal" tabindex="-1" aria-labelledby="chat-modal-label" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen-sm-down modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="chat-modal-label">Chatzin do Junin</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <ul id="messages" class="list-group list-group-flush"></ul>
        </div>
        <div class="modal-footer row">
          <form id="chat-form" class="col">
            <label for="messageInput" class="form-label">Digite sua mensagem</label>
            <div class="input-group">
              <input type="text" id="messageInput" class="form-control" aria-label="Digite sua mensagem"></input>
              <button type="submit" class="btn btn-primary input-group-text">
                Enviar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
</body>

<script src="/socket.io/socket.io.js"></script>

<script>
  const socket = io();

  const formChat = document.getElementById('chat-form');
  const inputChat = document.getElementById('messageInput');
  const messages = document.getElementById('messages');

  formChat.addEventListener('submit', function (e) {
    e.preventDefault();
    if (inputChat.value) {
      socket.emit('chat message', { message: inputChat.value });
      inputChat.value = '';
    }
  });

  socket.on('chat message', function (msg) {
    var item = document.createElement('li');
    var message = document.createElement('b');
    item.className = 'list-group-item shadow-sm mb-3 border-start border-primary rounded';
    message.textContent = msg.message;

    item.appendChild(message);
    messages.appendChild(item);
  });

  socket.on('hi', function (msg) {
    alert(msg.message)
    // item.textContent = "Say 'Hello' to new user!";
    // messages.appendChild(item);
    // window.scrollTo(0, document.body.scrollHeight);
  });
</script>

</html>